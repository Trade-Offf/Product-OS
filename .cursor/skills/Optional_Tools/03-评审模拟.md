# Skill: Review Simulator

## 📋 技能依赖声明

### 必须依赖
- ✅ `_WORK_SHEET.md` 文件存在（项目根目录）

### 可选依赖
- `03_Output/PRD_*.md` - 如果存在，优先评审PRD而非工作台

### 依赖检查失败时的提示
```
⚠️ 需求评审需要先完成需求拆解

请执行以下步骤：
1. 对AI说："整理一下" 或 "拆解需求"
2. 等待生成 _WORK_SHEET.md 文件
3. 填写文件中的待确认问题（可选）
4. 再次执行"评审"

当前缺失：_WORK_SHEET.md

提示：如果已有PRD文档，评审将基于PRD进行
```

## 🛡️ Safety Protocol (防幻觉协议)

- **Critical Thinking**: 以批判性思维挑战需求，但不瞎找茬。
- **Evidence Based**: 提出的问题必须基于文档内容，不能凭空假设。
- **Severity Grading**: 风险等级必须合理标注（🔴阻塞 / 🟡警告 / 🟢建议）。

## 🔄 跨文件协作协议 (The Loop Protocol)

本技能属于 "增量审计" 环节，严禁直接修改 PRD。

1.  **审计逻辑**：
    - 读取 `_WORK_SHEET.md` (查看已知决策) 和 `03_Output/PRD_Product_Spec.md` (查看当前文档)。
    - 根据本技能的专业视角（多角色评审）进行检查。

2.  **发现缺口 (Gap Detected)**：
    - 如果发现技术风险、逻辑漏洞或边界场景未定义，**严禁自行脑补**。
    - 请将新问题**追加**到 `_WORK_SHEET.md` 文件的 **Part 1** 底部：
      ```markdown
      Q_评审_[角色]_[序号]: [发现的新问题，如：并发扣减库存的锁机制未定义]
      [回答]: 
      ```

3.  **中断与提示**：
    - 追加问题后，**立即停止**当前任务。
    - 在对话框回复用户：
      "⚠️ 在需求评审中发现技术风险或逻辑缺口，已追加到 `_WORK_SHEET.md` 底部。
      请去文件中填写 `[回答]`，保存后再次发送 **'生成文档'** 指令，即可获得包含此细节的最新 PRD。"

## Description

模拟需求评审会议，AI 扮演不同角色（后端、前端、QA）对文档进行挑战 (Challenge)，找出潜在风险和遗漏点。

## 角色设定 (Personas)

### 1. 后端架构师 👨‍💻

**关注点**:

- 数据一致性（分布式事务、幂等性）
- 并发问题（锁、队列、限流）
- 性能瓶颈（N+1查询、慢SQL、缓存）
- 安全漏洞（SQL注入、越权、敏感数据）
- 数据库设计（表结构、索引、范式）

**典型问题**:

- "这里没写并发锁，高并发下库存会扣负"
- "用户ID是自增的吗？容易被遍历攻破"
- "这个列表接口没写分页，数据量大了会OOM"
- "删除操作是物理删除还是逻辑删除？"

### 2. 资深前端 👩‍💻

**关注点**:

- 组件复用（是否有重复轮子）
- 交互边界（loading、error、empty 状态）
- 异常处理（网络断开、超时、权限不足）
- 兼容性（浏览器、设备、屏幕尺寸）
- 性能优化（图片懒加载、虚拟滚动）

**典型问题**:

- "上传失败后，文件列表怎么展示？"
- "这个弹窗在移动端会不会遮挡内容？"
- "图片加载中显示什么占位符？"
- "断网时用户点击按钮，要不要禁用？"

### 3. QA 负责人 🧪

**关注点**:

- 测试用例覆盖（正常流程、异常流程、边界条件）
- 边缘场景（极端输入、异常顺序、并发操作）
- 逻辑闭环（状态流转是否完整）
- 回归影响（改动是否影响已有功能）

**典型问题**:

- "连续点击10次提交按钮会怎样？"
- "输入框最大长度限制是多少？超了怎么提示？"
- "订单状态能从'已完成'回退到'待发货'吗？"
- "A功能和B功能同时操作会冲突吗？"

## 评审流程

### Step 1: 读取文档

从以下位置读取需求文档：

- `01_Input/` - 原始需求
- `_WORK_SHEET.md` - 需求工作台
- `02_Process/feature_spec.md` - 结构化需求

### Step 2: 角色切换扫描

以 3 个角色的视角，分别扫描文档：

1. 后端架构师：关注数据和逻辑
2. 资深前端：关注交互和边界
3. QA 负责人：关注测试和闭环

### Step 3: 提出问题

每个角色提出 3-5 个最严重的问题。

### Step 4: 风险分级

| 风险等级 | 图标   | 含义                            | 示例                     |
| -------- | ------ | ------------------------------- | ------------------------ |
| 🔴 阻塞  | Red    | 不解决会导致严重 Bug 或安全问题 | 并发下库存扣负、SQL注入  |
| 🟡 警告  | Yellow | 可能导致体验问题或小概率 Bug    | 断网无提示、loading 缺失 |
| 🟢 建议  | Green  | 优化建议，不影响功能            | 性能优化、代码复用       |

## 输出格式

```markdown
# 需求评审意见

## 📄 评审文档

- 来源：`02_Process/feature_spec.md`
- 评审时间：YYYY-MM-DD HH:mm
- 评审人：后端架构师、资深前端、QA负责人

## ⚔️ 评审意见

### 后端架构师 👨‍💻

| 风险等级 | 问题点               | 影响分析                 | 修改建议                          |
| -------- | -------------------- | ------------------------ | --------------------------------- |
| 🔴 阻塞  | 库存扣减没有分布式锁 | 高并发下会超卖           | 使用 Redis 分布式锁或数据库悲观锁 |
| 🟡 警告  | 用户表使用自增ID     | 容易被遍历，存在安全隐患 | 改用 UUID 或雪花ID                |
| 🟢 建议  | 列表接口没写分页     | 数据量大时性能差         | 增加分页参数（page, pageSize）    |

### 资深前端 👩‍💻

| 风险等级 | 问题点             | 影响分析             | 修改建议                          |
| -------- | ------------------ | -------------------- | --------------------------------- |
| 🔴 阻塞  | 上传失败无错误提示 | 用户不知道发生了什么 | 增加 Toast 提示"上传失败，请重试" |
| 🟡 警告  | Loading 状态未定义 | 用户会疑惑是否在加载 | 增加 Skeleton 或 Spinner          |
| 🟢 建议  | 图片未做懒加载     | 首屏加载慢           | 使用 Intersection Observer 懒加载 |

### QA 负责人 🧪

| 风险等级 | 问题点                 | 影响分析                     | 修改建议                             |
| -------- | ---------------------- | ---------------------------- | ------------------------------------ |
| 🔴 阻塞  | 订单状态流转未完整定义 | 测试无法覆盖所有场景         | 补充状态机图，定义所有可能的状态变化 |
| 🟡 警告  | 输入框无长度限制       | 可能提交超长文本导致后端报错 | 前端限制最大长度，后端也要校验       |
| 🟢 建议  | 缺少并发操作测试用例   | 可能存在并发Bug              | 增加"同时提交两个订单"等并发场景     |

## 📊 风险统计

| 角色     | 🔴 阻塞 | 🟡 警告 | 🟢 建议 | 合计  |
| -------- | ------- | ------- | ------- | ----- |
| 后端     | 1       | 1       | 1       | 3     |
| 前端     | 1       | 1       | 1       | 3     |
| QA       | 1       | 1       | 1       | 3     |
| **总计** | **3**   | **3**   | **3**   | **9** |

## 🎯 优先处理建议

### 必须立即解决（🔴 阻塞）

1. 库存扣减增加分布式锁
2. 上传失败增加错误提示
3. 补充完整的订单状态流转定义

### 建议尽快解决（🟡 警告）

1. 用户ID 改用 UUID
2. 增加 Loading 状态
3. 输入框增加长度限制

### 可后续优化（🟢 建议）

1. 列表接口增加分页
2. 图片懒加载
3. 增加并发测试用例

## 💡 补充说明

> ⚠️ 注意：以上评审意见基于现有文档内容，实际开发中可能需要根据具体技术栈调整方案。

> ❓ 待确认：以下问题需要 PM 或技术负责人明确：
>
> 1. xxx
> 2. xxx
```

## 执行触发

当用户说以下关键词时，自动调用此技能：

- "评审" / "评审一下"
- "找漏洞" / "挑毛病"
- "Challenge" / "挑战"

## 输出位置

评审报告保存到：

- `02_Process/review_report.md`

## 注意事项

### ✅ 推荐做法

1. 问题要基于文档内容，不凭空假设
2. 风险等级标注合理，不夸大
3. 提出问题的同时给出解决建议
4. 关注实际开发中常见的坑

### ❌ 避免做法

1. 不要无脑挑刺，要有理有据
2. 不要所有问题都标"阻塞"
3. 不要提出无法验证的假设性问题
4. 不要重复提同一类问题

## 自检清单

输出前必须检查：

- [ ] 每个角色至少提出 3 个问题？
- [ ] 风险等级标注合理？
- [ ] 每个问题都给出了修改建议？
- [ ] 问题基于文档内容，非凭空假设？
- [ ] 按优先级排序了处理建议？
