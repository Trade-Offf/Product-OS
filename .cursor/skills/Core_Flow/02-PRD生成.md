# Skill: PRD Generator (产品文档生成引擎)

## 📋 技能依赖声明

### 必须依赖
- ✅ `_WORK_SHEET.md` 文件存在（项目根目录）
- ✅ `_WORK_SHEET.md` 包含 Part 1 和 Part 2

### 可选依赖
- `03_Output/` 中的已有PRD文件（用于版本号计算）

### 依赖检查失败时的提示
```
⚠️ PRD生成需要先完成需求拆解

请执行以下步骤：
1. 对AI说："整理一下" 或 "拆解需求"
2. 等待生成 _WORK_SHEET.md 文件
3. 填写文件中的待确认问题
4. 再次执行"生成文档"

当前缺失：_WORK_SHEET.md
```

### 状态检查提示
```
⚠️ 工作台中还有 {数量} 个待回答问题

建议：
- 先填写这些问题，可以生成更完整的PRD
- 或者直接生成，未回答的问题将归档到PRD的"待定事项"章节

是否继续生成？
```

## 🛡️ Safety Protocol (核心原则)

- **Decision First**: `_WORK_SHEET.md` 中的 **[回答]** 是最高指令。如果回答变更了，PRD 必须随之重写。
- **Iterative Update**: 这是一个动态更新过程。无论之前运行了什么 Skill (需求拆解/测试)，只要用户更新了回答，本 Skill 就负责输出当前状态下最完整的 PRD。
- **No Residuals**: 生成的文档中严禁保留 "Q&A"、"待确认列表" 等过程信息，必须转化为确定的功能描述。
- **Product Focus Only**: PRD只写"做什么"，不写"怎么做"。严禁包含：后端逻辑、接口设计、技术实现、数据库设计、架构设计等开发团队的工作内容。

## Description

这是产品工作流的**最终产出引擎**。
它的作用不是简单的“合并”，而是**编译**：读取工作台 (`_WORK_SHEET.md`) 里的所有逻辑和决策，构建或更新 `PRD_v2.0.md`。

**版本化规则**: 详见 `.cursor/skills/VERSION_GUIDE.md` - 包含版本号计算、文件命名、版本历史管理的完整说明。

## 处理流程

### Step 1: 加载上下文
- 读取项目根目录下的 `_WORK_SHEET.md`
- 扫描 `03_Output/` 目录，查找已有PRD文件（用于版本号计算）

### Step 2: 解析决策树与状态检查
- **读取元数据**: 检查 `_WORK_SHEET.md` 头部的 metadata 信息
  - 如果 `pending_count > 0`: 提示用户还有未回答的问题
  - 如果 `answered_count = 0`: 警告可能无法生成完整PRD
- 扫描 **Part 1 (待确认问题)**：
  - 只提取状态为 `[✅ 已回答]` 或 `[🔄 已更新]` 的问题答案
  - 跳过状态为 `[⏳ 待回答]` 或 `[❌ 已取消]` 的问题
- 扫描 **Part 2 (详细拆解)**：提取原始业务逻辑
- _注意：如果 Part 1 中追加了来自其他 Skill (如交互/测试) 的新问题且已回答，需同步更新到文档对应章节_

### Step 3: 版本号计算
- 检查 `03_Output/` 下是否已有同功能名的PRD文件
- 如果是首次生成：版本号 = `v1.0`
- 如果已有版本：
  - 对比本次内容与最新版本的差异
  - 判断是大改动（主版本+1）还是小改动（次版本+0.1）
  - 自动递增版本号

### Step 4: 构建文档
- 将 "原始逻辑" + "用户回答" 转化为正式的 PRD 语言
- (例如：问题是"入口在哪？" 回答是"首页顶部" -> 文档写入 "入口位置：首页顶部导航栏")
- 在文档头部添加版本历史表格
- **图片处理**: 如果原始文档中有图片引用，在PRD中保留图片占位符，由PM后续补充图片

### Step 5: 输出交付
- 生成文件名：`PRD_{功能名}_v{版本号}_{日期}.md`
- 保存到 `03_Output/` 目录
- **不删除旧版本文件**，保留完整版本历史

## 📸 图片与附件处理（简化版）

### 核心原则
**AI不负责图片处理**，只处理文字逻辑。图片由PM在PRD生成后自行补充。

### 处理方式

**如果原始需求中包含图片引用**：
- AI在PRD中添加图片占位符：`[图片占位：{图片说明}]`
- 由PM后续手动补充图片链接或截图

**示例**：
```markdown
### 2.1 Web端 - 用户界面改造

#### 2.1.1 登录页面

[图片占位：登录页面设计图 - 展示用户名密码输入框、记住我选项、登录按钮布局]

**功能说明**：
- 用户名输入框：支持手机号/邮箱登录
- 密码输入框：支持明文/密文切换
- 记住我：勾选后7天免登录
```

### PM补充图片的方式

**方式1: Markdown图片语法**
```markdown
![登录页面设计图](../01_Input/designs/login_page.png)
```

**方式2: 图片链接**
```markdown
设计图链接：https://www.figma.com/file/xxx/login-page
```

**方式3: 保留占位符**
```markdown
[图片占位：登录页面设计图] ← 待补充
```

### 为什么不自动处理图片？

1. **准确性问题**: AI无法准确判断图片与功能描述的对应关系
2. **复杂度问题**: 图片处理逻辑复杂，容易出错
3. **效率问题**: PM手动补充图片更快更准确
4. **职责分离**: AI负责逻辑整理，PM负责视觉呈现

## 🚫 PRD中严禁出现的内容

以下内容属于开发团队的工作，**绝对不能**出现在产品PRD中：

### 禁止内容清单
- ❌ **后端逻辑**：接口设计、API定义、数据库设计、缓存策略
- ❌ **技术实现**：代码逻辑、算法描述、技术选型、架构设计
- ❌ **接口文档**：请求参数、响应格式、错误码定义
- ❌ **数据结构**：表结构、字段类型、索引设计
- ❌ **性能优化**：具体的技术优化方案
- ❌ **推断逻辑**：不要写"需要接口返回XXX"、"后端需要校验XXX"

### 正确做法
- ✅ 描述**业务规则**：如"白名单通过后才能上传"（规则）
- ✅ 描述**用户行为**：如"用户点击按钮后，系统显示..."（交互）
- ✅ 描述**数据展示**：如"列表显示uid、状态、时间"（界面）
- ✅ 描述**权限控制**：如"只有代理用户可以..."（业务逻辑）

### 示例对比

❌ **错误写法**（写了技术实现）：
```
### 后端逻辑与接口设计
- 需要接口返回用户是否为代理身份
- 后端需要校验白名单状态
- 数据库需要存储上传时间戳
```

✅ **正确写法**（只写业务规则）：
```
### 权限与规则
- 系统根据用户身份展示不同功能（代理用户可切换背景图）
- 白名单状态为"已通过"时，用户才能上传个人LOGO
- 多处上传时，以最新上传的图片为准
```

## 输出模板 (Standard PRD)

```markdown
# [功能名称] 产品需求文档

| 文档信息     | 内容                  |
| :----------- | :-------------------- |
| **版本**     | v{版本号} (Auto-Generated) |
| **生成日期** | YYYY-MM-DD HH:mm      |
| **文件名**   | PRD_{功能名}_v{版本号}_{日期}.md |
| **状态**     | ✅ 已根据最新决策生成 |

## 📚 版本历史

| 版本 | 日期 | 主要变更 |
|------|------|---------|
| v{当前版本} | {当前日期} | {本次变更摘要} |
| v{上一版本} | {上一日期} | {上次变更摘要} |
| ... | ... | ... |

## 1. 🎯 核心目标

[基于 Part 2 的目标描述]

## 2. 📱 功能详细设计

### 2.1 [模块A - 按端拆分]

> _本章节已根据工作台决策更新_

#### 功能说明
[描述用户可以做什么]

**界面设计**：

[如果有相关设计图，引用图片]

![功能截图](../01_Input/converted/designs/图片名.png)

**设计说明**：
- UI元素：[描述界面元素]
- 交互规则：[用户操作和系统响应]
- 业务规则：[权限、限制、条件]
- 异常处理：[失败时的处理方式]

### 2.2 [模块B]

...

## 3. ⚠️ 全局限制与规则

[业务规则、权限控制、数据规则，但不涉及技术实现]

## 4. 🔄 异常流程与边界处理

[用户视角的异常场景和处理方式]

## 5. 📝 遗留/待定事项 (To-Do)

[如果 Part 1 中仍有**未回答**的问题，自动归档到这里]

---

_Generated by Cursor PRD Generator_
```
