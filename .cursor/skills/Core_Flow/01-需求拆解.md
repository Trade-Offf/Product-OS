# Skill: Logic Extractor (File-Based Edition)

## 📋 技能依赖声明

### 必须依赖

- ✅ `01_Input/` 目录存在
- ✅ `01_Input/` 中至少有一个输入文件（.md / .pdf / 图片描述）

### 可选依赖

- 无

### 依赖检查失败时的提示

```
⚠️ 需求拆解需要输入文件，请先将需求文档放入 01_Input/ 目录

支持的格式：
- Markdown文档（.md）
- PDF文档（.pdf）
- 截图描述（.png, .jpg）
- 其他文本格式
```

## 🛡️ Safety Protocol (防幻觉协议)

- **Strict Scope**: 仅提取文档中显式提到的逻辑。
- **Gap Flagging**: 遇到逻辑断层（如：提到"审核"但没说"谁审核"），请标注 `> ❓ 待确认`，严禁自动补全。
- **Question Context**: 每个待确认问题必须引用触发该问题的原文，让PM能够基于上下文回答问题。
- **No Invention**: 不发明、不脑补、不优化原文未提及的内容。
- **Source Tracking**: 每个提取的功能点都标注来源（原文：xxx）。
- **File Output Only**: 结果必须写入 `_WORK_SHEET.md`，严禁在对话框直接输出分析全文。
- **Exclude Dev Content**: 排除开发阶段的内容（功能拆分表格、排期安排、开发人员信息等）。
- **Text Focus**: 专注提取文字逻辑，图片内容由产品在PRD阶段自行补充。

## Description

专门用于处理自然语言描述的混合需求文档，将其拆解为分端、分角色的清晰条目，并生成工作台文件。

## 处理规则

### 1. 分端拆解

强制拆分为以下分类：

- **[Web端]**: PC浏览器访问的功能
- **[App端]**: iOS/Android 原生应用功能
- **[管理后台]**: 运营/管理员使用的后台系统
- **[API/后端]**: 纯后端逻辑，无前端界面

### 2. 页面级别拆解（重要）

在每个端的分类下，按 **页面/URL** 进一步分组：

**拆解原则**：

- 同一个 URL/页面路径下的所有功能，归为一组
- 每个页面组包含：页面路径、页面功能列表
- 如果原文未明确提及 URL，按页面名称分组（如"个人中心页"、"订单列表页"）
- 如果连页面名称都没有，标记 `> ❓ 待确认：该功能所属页面`

**输出格式示例**：

```markdown
#### Web端

##### 页面：用户中心 (`/user/profile`)

- 功能1：修改昵称
- 功能2：上传头像（限制：≤2M，jpg/png）
- 功能3：查看积分余额

##### 页面：订单列表 (`/orders`)

- 功能1：查询订单（支持按状态筛选）
- 功能2：取消订单
- 功能3：申请售后

> ❓ 待确认：订单详情功能是独立页面（`/orders/:id`）还是弹窗？
```

**防脑补规则**：

- 如果原文写"用户可以查看订单"，但没说在哪个页面 → 标记 `❓ 待确认`
- 如果原文写"个人中心有修改昵称功能"，但没说 URL → 写页面名称，URL 留空或标记待确认
- 不要自己编造 URL 路径结构

### 3. 规则提取

抓取所有数字、限制、约束条件，归类到 **[限制规则]**：
**示例**:

- "图片不超过 2M" → 文件大小：≤2M
- "仅支持 jpg/png" → 文件格式：jpg, png
  **原则**: 只记录原文明确提到的限制。

### 4. 异常捕获

识别兜底逻辑和异常处理，归类到 **[异常流程]**：
**示例**:

- "失败显示空白" → 错误状态：显示空白占位
  **原则**: 如果原文未提及异常处理，标注 `> ❓ 待确认`。

### 5. 文字逻辑优先

**处理原则**：

- 专注提取文字描述的功能逻辑、业务规则、交互流程
- 不处理图片内容，图片由产品在PRD生成阶段自行补充
- 如果文档中有图片相关的文字描述（如"下图展示..."），保留文字部分，但不强制记录图片位置

## 📝 输出规则 (核心变更)

**输出路径**: `_WORK_SHEET.md` (项目根目录，唯一文件)

请**创建或覆盖**根目录下的 `_WORK_SHEET.md` 文件。文件内容必须包含两部分：

1.  **待确认问题区**：供用户直接填写。
2.  **详细拆解报告**：即原本你应该输出的完整分析内容。

### `_WORK_SHEET.md` 文件模板：

'''markdown

# 🛠️ 需求拆解工作台

---

created_at: {创建时间}
last_updated: {最后更新时间}
status: pending
pending_count: {待回答问题数量}
answered_count: {已回答问题数量}

---

> 📊 **当前状态**: 待确认 | 待回答问题: {数量}个 | 已回答: {数量}个
>
> **状态说明**: pending(待填写) | in_progress(填写中) | completed(已完成)

## Part 1: 待确认问题汇总 (请在此填写)

### Q1 [⏳ 待回答]

**来源**: 01-需求拆解  
**原文**: "[引用触发该问题的原文内容]"  
**问题**: [问题描述]  
**[回答]**:

### Q2 [⏳ 待回答]

**来源**: 01-需求拆解  
**原文**: "[引用触发该问题的原文内容]"  
**问题**: [问题描述]  
**[回答]**:

### Q3 [⏳ 待回答]

**来源**: 01-需求拆解  
**原文**: "[引用触发该问题的原文内容]"  
**问题**: [问题描述]  
**[回答]**:

---

## Part 2: 详细拆解报告 (AI生成)

### 🎯 核心目标

[内容...]

### 📱 分端拆解

#### Web端

##### 页面：[页面名称] (`[URL路径]`)

- 功能1：[功能描述]（原文："xxx"）
- 功能2：[功能描述]（原文："xxx"）

> ❓ 待确认：[页面相关的待确认问题]

##### 页面：[页面名称2] (`[URL路径2]`)

- 功能1：[功能描述]

---

#### App端

##### 页面：[页面名称]

- 功能1：[功能描述]（原文："xxx"）
- 功能2：[功能描述]（原文："xxx"）

---

#### 管理后台

##### 页面：[页面名称] (`[URL路径]`)

- 功能1：[功能描述]

---

#### API/后端

- 接口1：[接口描述]（原文："xxx"）
- 接口2：[接口描述]（原文："xxx"）

---

### ⚠️ 限制规则

- [内容...]

### 🔄 异常流程

- [内容...]

### 🔗 依赖关系

- [内容...]

### 📝 原文摘录

- [内容...]
  '''

## 📋 PDF文档处理说明

如果输入文件是PDF格式，直接基于文字内容进行拆解：

1. **排除开发内容**（重要）：
   - 拆解需求时，**忽略以下内容**：
     - ❌ 功能拆分表格（前后端分工、估时等）
     - ❌ 排期甘特图、开发时间线
     - ❌ 开发人员投入安排、头像信息
   - 这些是需求评审通过后，开发团队填写的内容，不属于需求阶段

2. **图片处理**：
   - 不处理图片内容，图片由产品在PRD阶段自行补充
   - 专注提取文字描述的功能逻辑

## 执行触发

**触发词管理**: 所有触发词统一在 `.cursor/skills/ROUTER.md` 中定义和维护。

**本技能触发词**: 参见路由表的 "01 - 需求拆解" 章节。

## 📊 状态标记说明

### 问题状态

- `[⏳ 待回答]` - 问题已提出，等待PM填写
- `[✅ 已回答]` - 问题已回答
- `[🔄 已更新]` - 答案已修改/补充
- `[❌ 已取消]` - 问题不需要回答

### 元数据说明

```yaml
---
created_at: 2026-01-29 14:00
last_updated: 2026-01-29 15:30
status: pending
pending_count: 5
answered_count: 2
---
```

**字段说明**：

- `created_at`: 创建时间
- `last_updated`: 最后更新时间
- `status`: 整体状态（pending/in_progress/completed）
- `pending_count`: 待回答问题数
- `answered_count`: 已回答问题数

### 状态自动更新规则

- **生成工作台时**: status = `pending`, pending_count = 问题总数
- **PM填写答案后**: 手动将问题状态改为 `[✅ 已回答]`，或让AI更新
- **执行"生成文档"时**: AI扫描所有问题状态，更新元数据

## 自检清单

输出文件前必须检查：

- [ ] 是否已生成 `_WORK_SHEET.md` 文件？
- [ ] 是否已添加元数据头部（包含状态信息）？
- [ ] 每个问题是否都有状态标记 `[⏳ 待回答]`？
- [ ] 每个问题是否都标注了来源（如"01-需求拆解"）？
- [ ] **每个问题是否都引用了触发该问题的原文**（**原文**: "xxx"）？
- [ ] 待确认问题是否已提取到文件顶部的 Part 1 区域？
- [ ] 每个功能点是否都标注了来源（原文："xxx"）？
- [ ] 所有未明确的地方都标记了 `> ❓ 待确认`？
- [ ] **是否按页面级别分组**：同一 URL/页面下的功能是否归在一起？
- [ ] **页面路径处理**：如果原文未提及 URL，是否标记待确认而非自己编造？