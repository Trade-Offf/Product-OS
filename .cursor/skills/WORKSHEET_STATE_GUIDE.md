# 工作台状态管理指南

> **作用**: 为 `_WORK_SHEET.md` 提供结构化的状态追踪机制。

---

## 📊 状态管理概述

### 为什么需要状态管理？

**问题场景**：
- PM填写了哪些问题？哪些还没填？
- 多次"生成文档"后，不知道哪些是新增问题
- 可选工具追加的问题容易被遗漏

**解决方案**：
- 为每个问题添加状态标记
- 在文件头部添加元数据，统计进度
- AI自动更新状态，PM一目了然

---

## 🏷️ 问题状态标记

### 状态类型

| 状态 | 图标 | 说明 | 使用场景 |
|------|------|------|---------|
| **待回答** | `[⏳ 待回答]` | 问题已提出，等待填写 | AI生成工作台时的默认状态 |
| **已回答** | `[✅ 已回答]` | 问题已填写答案 | PM填写后手动改为此状态 |
| **已更新** | `[🔄 已更新]` | 答案已修改/补充 | PM二次修改答案后标记 |
| **已取消** | `[❌ 已取消]` | 问题不需要回答 | PM评估后决定跳过 |

### 问题格式

```markdown
### Q{序号} [{状态图标}] 
**来源**: {技能名称}  
**优先级**: {高/中/低}  
**问题**: {问题描述}  
**[回答]**: {PM填写的答案}

---
```

### 示例

```markdown
### Q1 [⏳ 待回答] 
**来源**: 01-需求拆解  
**优先级**: 高  
**问题**: 白名单审核的负责人是谁？运营还是产品？  
**[回答]**: 

---

### Q2 [✅ 已回答]
**来源**: 01-需求拆解  
**优先级**: 中  
**问题**: 上传失败后是否需要提示用户？  
**[回答]**: 需要，显示Toast提示"上传失败，请重试"

---

### Q3 [🔄 已更新]
**来源**: 02-Mermaid流程图  
**优先级**: 高  
**问题**: 支付失败后的回退流程是什么？  
**[回答]**: 
- 首次修改: 返回订单列表，保留订单状态为"待支付"
- 二次补充: 超时30分钟后自动取消订单

---

### Q4 [❌ 已取消]
**来源**: 03-评审模拟  
**优先级**: 低  
**问题**: 是否需要增加操作日志记录？  
**[回答]**: 暂不考虑，留到V2.0版本

---
```

---

## 📋 元数据头部

### 格式

```markdown
---
metadata:
  created_at: 2026-01-29 14:00
  last_updated: 2026-01-29 15:30
  status: in_progress
  total_questions: 10
  pending_count: 5
  answered_count: 4
  cancelled_count: 1
---
```

### 字段说明

| 字段 | 类型 | 说明 |
|------|------|------|
| `created_at` | DateTime | 工作台创建时间 |
| `last_updated` | DateTime | 最后更新时间（PM填写或AI追加问题） |
| `status` | Enum | 整体状态：pending / in_progress / completed |
| `total_questions` | Number | 问题总数 |
| `pending_count` | Number | 待回答问题数（⏳） |
| `answered_count` | Number | 已回答问题数（✅ + 🔄） |
| `cancelled_count` | Number | 已取消问题数（❌） |

### 状态计算规则

```
total_questions = pending_count + answered_count + cancelled_count

status 判断：
- pending: pending_count = total_questions (所有问题都未回答)
- in_progress: 0 < pending_count < total_questions (部分已回答)
- completed: pending_count = 0 (所有问题都已回答或取消)
```

---

## 🔄 状态自动更新流程

### Step 1: 工作台生成时（01-需求拆解）

```markdown
metadata:
  created_at: 2026-01-29 14:00
  last_updated: 2026-01-29 14:00
  status: pending
  total_questions: 5
  pending_count: 5
  answered_count: 0
  cancelled_count: 0

所有问题状态: [⏳ 待回答]
```

### Step 2: PM填写答案后

**手动方式**：
```markdown
将 [⏳ 待回答] 改为 [✅ 已回答]
```

**AI辅助方式**：
```
对AI说："更新工作台状态"
AI扫描所有 [回答] 字段，自动更新状态和元数据
```

### Step 3: 可选工具追加问题时

```markdown
### Q6 [⏳ 待回答]  ← 新增问题
**来源**: 02-Mermaid流程图  
**优先级**: 高  
**问题**: 订单状态流转的完整路径是什么？  
**[回答]**: 

---
```

**元数据自动更新**：
```markdown
total_questions: 5 → 6
pending_count: 2 → 3
last_updated: 更新为追加时间
```

### Step 4: 执行"生成文档"时（02-PRD生成）

AI读取元数据，判断：
```
if pending_count > 0:
  提示: "⚠️ 工作台中还有 {pending_count} 个待回答问题，建议填写后再生成PRD"
  
if answered_count = 0:
  警告: "⚠️ 所有问题都未回答，生成的PRD可能不完整"
```

---

## 🎯 优先级管理

### 优先级定义

| 优先级 | 说明 | 建议处理 |
|--------|------|---------|
| **高** | 不回答会导致PRD逻辑不闭环 | 必须回答 |
| **中** | 不回答会影响PRD质量 | 建议回答 |
| **低** | 补充细节，可后续完善 | 可选回答 |

### 优先级判断依据

**高优先级**：
- 核心流程的关键节点（如"审核通过后怎么办？"）
- 权限和角色定义（如"谁可以操作？"）
- 数据规则（如"字段取值范围是什么？"）

**中优先级**：
- 交互细节（如"失败提示文案是什么？"）
- 边界条件（如"最大长度是多少？"）
- 异常处理（如"网络断开怎么办？"）

**低优先级**：
- 视觉细节（如"按钮颜色是什么？"）
- 可选功能（如"是否需要操作日志？"）
- 待定事项（如"V2.0是否支持批量操作？"）

---

## 📊 进度可视化

### 在工作台头部显示进度

```markdown
> 📊 **当前状态**: 填写中 | 总计: 10个问题 | 已回答: 6个 | 待回答: 3个 | 已取消: 1个

进度条: ████████░░ 60% 完成
```

### 按来源分组统计

```markdown
## 问题统计

| 来源 | 总计 | 待回答 | 已回答 | 已取消 |
|------|------|--------|--------|--------|
| 01-需求拆解 | 5 | 2 | 3 | 0 |
| 02-Mermaid流程图 | 3 | 1 | 1 | 1 |
| 03-评审模拟 | 2 | 0 | 2 | 0 |
| **合计** | **10** | **3** | **6** | **1** |
```

---

## ✅ 最佳实践

### 推荐工作流

```
Step 1: AI生成工作台
  → 所有问题默认 [⏳ 待回答]

Step 2: PM逐个填写高优先级问题
  → 填写后改为 [✅ 已回答]

Step 3: PM评估中优先级问题
  → 重要的填写，不重要的标记 [❌ 已取消]

Step 4: 对AI说"生成文档"
  → AI只使用 [✅ 已回答] 的问题答案
  → [⏳ 待回答] 的问题归档到PRD的"待定事项"

Step 5: 可选工具追加新问题
  → 回到 Step 2，继续填写

Step 6: 再次"生成文档"
  → 生成新版本PRD (v1.1 → v1.2)
```

### 避免的错误

❌ **错误1**: 填写答案后忘记更新状态
```
问题: [⏳ 待回答]
回答: 已填写...  ← AI无法识别，因为状态仍是"待回答"
```

✅ **正确做法**: 填写后改为 `[✅ 已回答]`

❌ **错误2**: 直接删除不需要的问题
```
如果删除问题，元数据的 total_questions 会不匹配
```

✅ **正确做法**: 标记为 `[❌ 已取消]`

❌ **错误3**: 不使用优先级
```
无法判断哪些问题必须回答，哪些可以跳过
```

✅ **正确做法**: AI生成问题时自动标注优先级

---

## 🔧 辅助命令（未来扩展）

### 状态更新命令
```
对AI说："更新工作台状态"
→ AI扫描所有问题，自动更新元数据
```

### 进度查询命令
```
对AI说："查看进度"
→ AI返回当前完成度、待办问题列表
```

### 批量操作命令
```
对AI说："标记Q1-Q5为已回答"
→ AI批量更新状态
```

---

_Last Updated: 2026-01-29_
